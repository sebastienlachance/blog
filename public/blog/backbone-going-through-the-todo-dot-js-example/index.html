
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Backbone - Going through the todo.js example - Sebastien Lachance</title>
  <meta name="author" content="Sebastien Lachance">

  
  <meta name="description" content="Over the past days, I have been struggling a lot to understand Backbone and how to apply it in other situations than a todo list. I read and reread &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://sebastienlachance.com/blog/backbone-going-through-the-todo-dot-js-example">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="http://feeds.feedburner.com/sebastienlachance/feed" rel="alternate" title="Sebastien Lachance" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-10165653-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Sebastien Lachance</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/sebastienlachance/feed" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:sebastienlachance.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/resume">Resume</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Backbone - Going through the todo.js example</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-02T08:52:00-05:00" pubdate data-updated="true">Mar 2<span>nd</span>, 2012</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>Over the past days, I have been struggling a lot to understand Backbone and how to apply it in other situations than a todo list.</p>

<p>I read and reread and even rewrite the Todo demo application for Backbone. But, If I wanted to redo it, I was lost. No idea where to go after models are created.</p>

<p>So here it is, I wanted to mimic the way I would recreate the way this application would have been created from scratch by a Backbone apprentice like me, one functionnality at a time.</p>

<p>The demo application is using a local storage mechanism, but I provide the way it would have been if it was a rails application.</p>

<p>rails new backbone_todo
rails g scaffold todo text:string done:boolean</p>

<p>Go to Backbone doc site, place backbone.js and underscore.js in app/assets/javascripts</p>

<p>Open application.js and make the following modifications</p>

<p>  //= require underscore
  //= require backbone
  //= require todo</p>

<p>Remove todo.js.coffee if you will not use CoffeeScript.</p>

<p>Open app/views/todos/index.html and put the following html:</p>

<p>  <div id="todoapp"></p>

<pre><code>  &lt;div class="title"&gt;
    &lt;h1&gt;Todos&lt;/h1&gt;
  &lt;/div&gt;

  &lt;div class="content"&gt;

    &lt;div id="create-todo"&gt;
      &lt;input id="new-todo" placeholder="What needs to be done?" type="text" /&gt;
      &lt;span class="ui-tooltip-top" style="display:none;"&gt;Press Enter to save this task&lt;/span&gt;
    &lt;/div&gt;

    &lt;div id="todos"&gt;
      &lt;ul id="todo-list"&gt;&lt;/ul&gt;
    &lt;/div&gt;

    &lt;div id="todo-stats"&gt;&lt;/div&gt;

  &lt;/div&gt;

&lt;/div&gt;

&lt;ul id="instructions"&gt;
  &lt;li&gt;Double-click to edit a todo.&lt;/li&gt;
  &lt;li&gt;&lt;a href="http://documentcloud.github.com/backbone/docs/todos.html"&gt;View the annotated source.&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;div id="credits"&gt;
  Created by
  &lt;br /&gt;
  &lt;a href="http://jgn.me/"&gt;J&amp;eacute;r&amp;ocirc;me Gravel-Niquet&lt;/a&gt;
&lt;/div&gt;

&lt;!-- Templates --&gt;

&lt;script type="text/template" id="item-template"&gt;
  &lt;div class="todo {{= done ? 'done' : '' }}"&gt;
    &lt;div class="display"&gt;
      &lt;input class="check" type="checkbox" {{= done ? 'checked="checked"' : '' }} /&gt;
      &lt;div class="todo-text"&gt;&lt;/div&gt;
      &lt;span class="todo-destroy"&gt;&lt;/span&gt;
    &lt;/div&gt;
    &lt;div class="edit"&gt;
      &lt;input class="todo-input" type="text" value="" /&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/script&gt;

&lt;script type="text/template" id="stats-template"&gt;
  {{ if (total) { }}
    &lt;span class="todo-count"&gt;
      &lt;span class="number"&gt;{{= remaining }}&lt;/span&gt;
      &lt;span class="word"&gt;{{= remaining == 1 ? 'item' : 'items' }}&lt;/span&gt; left.
    &lt;/span&gt;
  {{ } }}
  {{ if (done) { }}
    &lt;span class="todo-clear"&gt;
      &lt;a href="#"&gt;
        Clear &lt;span class="number-done"&gt;{{= done }}&lt;/span&gt;
        completed &lt;span class="word-done"&gt;{{= done == 1 ? 'item' : 'items' }}&lt;/span&gt;
      &lt;/a&gt;
    &lt;/span&gt;
  {{ } }}
&lt;/script&gt;
</code></pre>

<p>Now let&#8217;s get to the core of backbone.</p>

<ol>
<li>Create a todo</li>
</ol>


<p>In document ready</p>

<p>  $(function() {</p>

<pre><code>//Needed if you use erb with rails
_.templateSettings = {
  interpolate: /\{\{\=(.+?)\}\}/g,
  evaluate: /\{\{(.+?)\}\}/g
};


//code here
</code></pre>

<p>  });</p>

<p>Create a view that represent the application.</p>

<p>  window.AppView = Backbone.View.extend({});</p>

<p>Then we want to react when the user press enter after entering a todo.</p>

<p>  window.AppView = Backbone.View.extend({</p>

<pre><code>el: '#todoapp',

events: function() {
  "keypress #new-todo" : "createOnEnter"
},

createOnEnter: function() {

}
</code></pre>

<p>  });</p>

<p>What we have just done is to create a view that will listen to the keypress event on the element with the id new-todo, and call the function createOnEnter when pressing a key.</p>

<p>The el property (element) will tell the view to which element in the DOM it is binded to. In that case, without the</p>

<p>Creating the elemnt</p>

<p>Add the following method that will be called when creating the view and setting the input property to the correct element.</p>

<p>In window.AppView:</p>

<p>initialize: function() {
  this.input = this.$(&#8216;#new-todo);
}</p>

<p>And then we create the Todos (again in window.AppView)</p>

<p>  createOnEnter : function(e) {</p>

<pre><code>var text = this.input.val();
if (!text || e.keyCode != 13) return;
Todos.create({text: text});
this.input.val();
</code></pre>

<p>  }</p>

<p>Running the code now and trying to enter an item will result in : Uncaught ReferenceError: Todos is not defined</p>

<p>It&#8217;s because we are calling the create method on something that does not yet exists.</p>

<p>Todos is actually a collection of Todo model.</p>

<p>Let&#8217;s define them both in the document ready function</p>

<p>  window.Todo = Backbone.Model.extend({});</p>

<p>There we have created the Todo model.</p>

<p>  window.TodoList = Backbone.Collection.extend({</p>

<pre><code>model: Todo
</code></pre>

<p>  });</p>

<p>  window.Todos = new TodoList();</p>

<p>And now we have create the collection that will hold the Todo models. We started by extending Backbone.Collection and provide Todo as the model of the collection.</p>

<p>Let&#8217;s run the example again:</p>

<p>Now we have : Uncaught Error: A &#8220;url&#8221; property or function must be specified</p>

<p>Ahh, let&#8217;s fix this easily.</p>

<p>  window.TodoList = Backbone.Collection.extend({</p>

<pre><code>model: Todo,
url: '/todos'
</code></pre>

<p>  });</p>

<p>Now it would be great to display the added item in the list.</p>

<p>For this we need to react to the add, reset and all event</p>

<p>In window.AppView the initialize function change for:</p>

<p>  initialize: function() {</p>

<pre><code>this.input = this.$('#new-todo');

Todos.bind('add', this.addOne, this);
Todos.bind('reset', this.addAll, this);
Todos.bind('all', this.render, this);
</code></pre>

<p>  }</p>

<p>In details :</p>

<p>Todos.bind : It is currently deprecated in favor of &#8220;on&#8221; to follow the jQuery direction but still supported for backward compatibility:</p>

<p>{% blockquote
  onobject.on(event, callback, [context]) Alias: bind
%}</p>

<p>The first argument is the event we want to listen, the second is the callback method to be called and the third optional parameters is the context.</p>

<p>We listen to three events:</p>

<ol>
<li>add : Is called when a model is added to the collection</li>
<li>reset : When the whole collection or more than one model is changed (like reloading the collection)</li>
<li>all : Any event</li>
</ol>


<p>Reacting to the add event on collection:</p>

<p>In window.AppView</p>

<p>  addOne: function(todo) {</p>

<pre><code>var view = new TodoView({model: todo});
$('#todo-list').append(view.render().el);
</code></pre>

<p>  },</p>

<p>  addAll: function() {</p>

<pre><code>Todos.each(this.addOne);
</code></pre>

<p>  }</p>

<p>So the addOne callback is going to create a TodoView and add it to #todo-list.</p>

<p>The TodoView:</p>

<p>  window.TodoView = Backbone.View.extend({</p>

<pre><code>tagName: 'li',

template: _.template($('#item-template').html()),

render: function() {
  $(this.el).html(this.template(this.model.toJSON()));
  this.setText();
  return this;
},

setText: function() {
  var text = this.model.get('text');
  this.$('.todo-text').text(text);
  this.input = this.$('.todo-input');
  this.input.val(text);
} 
</code></pre>

<p>  });</p>

<p>First, we extend Backbone.View to create a view. The tagName represent the top element that we will add the Todo content to. In this case it&#8217;s a list element so we use an li tag. Second, the template. Remember in our html, we were having a &lt;script type=&#8221;text/template&#8221;&gt; tag. This is actually a template that we will fill using underscore and our model converted to JSON.</p>

<p>And finally we have the render method, that will use the rendered template and add it to our li element. The model property is automatically assigned when creating the view. The setText method, add the todo text to the display element and the edit element, (more on this later);</p>

<p>Let&#8217;s run it and see for ourselves how it&#8217;s working so far.</p>

<p>ohoh:  Uncaught ReferenceError: done is not defined</p>

<p>We don&#8217;t have any done property on our model.</p>

<p>Open up the Todo model and add some defaults :</p>

<p>window.Todo = Backbone.Model.extend({
  defaults: function() {</p>

<pre><code>return {
  done: false
}
</code></pre>

<p>  }
});</p>

<p>Everythings run fine now.</p>

<p>Let&#8217;s handle the done checkbox.</p>

<p>Add an event to our TodoView to react on the click on checkbox.</p>

<p>  events: {</p>

<pre><code>"click .check": "toggleDone"
</code></pre>

<p>  },</p>

<p>  toggleDone: function() {</p>

<pre><code>this.model.toggle();
</code></pre>

<p>  },</p>

<p>  initialize: function() {</p>

<pre><code>this.model.bind('change', this.render, this);
</code></pre>

<p>  }</p>

<p>And in our Todo model:</p>

<p>  toggle: function() {</p>

<pre><code>this.save({done: !this.get("done")});
</code></pre>

<p>  }</p>

<p>Since we have added code to react to the change event with the render callback, the view will be automatically be rerenderd with the new content. And the template show correctly the done item.</p>

<p>Run it. Warning. : With Rails, you will get Can&#8217;t mass-assign protected attributes: id</p>

<p>One thing that would be great is to actually reload saved todo when we refresh the page.</p>

<p>Easy:</p>

<p>In the initialize function of the AppView ask the Todo collection to fetch itself.</p>

<p>window.AppView = Backbone.View.extend({</p>

<p>  //code</p>

<p>  initialize: function() {</p>

<pre><code>//more code

Todos.fetch();
</code></pre>

<p>  }</p>

<p>  //code</p>

<p>});</p>

<p>Deleting</p>

<p>Add an event to detect the delete button click.</p>

<p>In window.AppView</p>

<p>window.TodoView = Backbone.View.extend({</p>

<p>  //code</p>

<p>  events: {</p>

<pre><code>//code
"click span.todo-destroy", "clear"
</code></pre>

<p>  },</p>

<p>  //code</p>

<p>  intialize: function() {</p>

<pre><code>//code

this.model.bind('destroy', this.remove, this);
</code></pre>

<p>  },</p>

<p>  clear: function() {</p>

<pre><code>this.model.destroy();
</code></pre>

<p>  },</p>

<p>  remove: function() {</p>

<pre><code>$(this.el).remove();
</code></pre>

<p>  }</p>

<p>});</p>

<p>Editing</p>

<p>window.TodoView = Backbone.View.extend({</p>

<p>  //code</p>

<p>  events {</p>

<pre><code>//code    

"dblclick div.todo-text" : "edit",
"keypress .todo-input"   : "updateOnEnter"
</code></pre>

<p>  },</p>

<p>  //code</p>

<p>  edit: function() {</p>

<pre><code>$(this.el).addClass("editing");
this.input.focus();
</code></pre>

<p>  },</p>

<p>  updateOnEnter: function(e) {</p>

<pre><code>if (e.keyCode == 13) this.close();
</code></pre>

<p>  },</p>

<p>  close: function() {</p>

<pre><code>this.model.save({text: this.input.val()});
$(this.el).removeClass("editing");
</code></pre>

<p>  }</p>

<p>});</p>

<p>Adding the class editing, hides the div containing the todo text and show a div containing an text field with the content already been filled (via the template).</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Sebastien Lachance</span></span>

      








  


<time datetime="2012-03-02T08:52:00-05:00" pubdate data-updated="true">Mar 2<span>nd</span>, 2012</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://sebastienlachance.com/blog/backbone-going-through-the-todo-dot-js-example/" data-via="slachance" data-counturl="http://sebastienlachance.com/blog/backbone-going-through-the-todo-dot-js-example/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/converting-a-blogengine-dot-net-blog-to-octopress/" title="Previous Post: Converting a BlogEngine.Net blog to Octopress">&laquo; Converting a BlogEngine.Net blog to Octopress</a>
      
      
        <a class="basic-alignment right" href="/blog/filling-a-select-from-an-array-on-javascript-object/" title="next Post: Filling a select from an array on javascript object">Filling a select from an array on javascript object &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>About Me</h1>
  <img src="/images/me.png" />
  <p>Sebastien Lachance, programmer since 2003.</p>
  <p>I am an entrepreneur and consultant. I have launched the <a href="http://www.guidedescommercesdebeauce.com">Guide des Commerces</a> in 2011, a project with great potential and had a lot of fun making it. 
  </p>
  <p>
    I'm a web developer specialized in Rails and ASP.NET MVC. I have a background in business applications but I really enjoy making any kind of software. 
  </p>
  <p>
    I do believe in the power of twitter, but I dont use it as much as I would.
    But feel free to follow me anyway :).
  </p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/rails-assets-pipeline-and-missing-assets/">Rails Assets Pipeline and missing assets</a>
      </li>
    
      <li class="post">
        <a href="/blog/method-decorators-in-ruby/">Method decorators in Ruby</a>
      </li>
    
      <li class="post">
        <a href="/blog/learning-rails-assert-valid-keys/">Learning Rails : assert_valid_keys</a>
      </li>
    
      <li class="post">
        <a href="/blog/backbone-and-page-transition/">Backbone and page transition</a>
      </li>
    
      <li class="post">
        <a href="/blog/large-scale-javascript-application-architecture-by-addy-osmani/">Large-scale Javascript Application Architecture by Addy Osmani</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>Github Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/sebastienlachance">@sebastienlachance</a> on Github
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'sebastienlachance',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("slachance", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/slachance" class="twitter-follow-button" data-show-count="true">Follow @slachance</a>
  
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Sebastien Lachance -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'sebastienlachance';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://sebastienlachance.com/blog/backbone-going-through-the-todo-dot-js-example/';
        var disqus_url = 'http://sebastienlachance.com/blog/backbone-going-through-the-todo-dot-js-example/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
